<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>Starter Template - Materialize</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <script src="https://use.fontawesome.com/f5f2e38ee4.js"></script>
</head>
<body>
  <nav class="light-blue lighten-1" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" href="#" class="brand-logo">Online House Selling</a>
      <ul class="right hide-on-med-and-down">
        <li><a href="#">Home</a></li>
      </ul>

      <ul id="nav-mobile" class="side-nav">
        <li><a href="#">Home</a></li>
      </ul>
      <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
    </div>
  </nav>



  <div class="container" id="app">
    <div class="section">
      <br><br>
      <ul class="collapsible" data-collapsible="accordion">
        <li>
          <div id="open_form" class="collapsible-header"><i class="fa fa-home" aria-hidden="true"></i>Add House</div>
          <div class="collapsible-body">
            <div class="row">
              <form class="col s12">
                <div class="row">
                  <div class="input-field col s6">
                    <input placeholder="Please input your name" id="name" type="text" class="validate">
                    <label for="name">Name</label>
                  </div>
                  <div class="input-field col s6">
                    <input id="price" placeholder="Input the house price" type="number" class="validate">
                    <label for="price">Price</label>
                  </div>
                </div>
                <div class="row">
                  <div class="input-field col s12">
                    <input placeholder="House Specification" id="spec" type="text" class="validate">
                    <label for="spec">Specification</label>
                  </div>
                </div>
                <div class="row">
                  <div class="input-field col s12">
                    <input id="image" placeholder="Input the URL of the house image" type="text" class="validate">
                    <label for="image">House Image</label>
                  </div>
                </div>
                <div id="map" style="width:100%; height:400px;"></div>
                <button class="waves-effect waves-light btn" v-on:click="addHouse"><i class="material-icons left">input</i>button</button>
              </form>
            </div>
          </div>
        </li>
      </ul>
    </div>
    <br>
    <div class="section" v-for="house in houses">
      <div class="row">
        <div class="col s12">
          <div class="card white">
            <div class="card-content" style="height:450px;">
              <div class="col s6">
                <img style="width:100%" :src="house.image" alt="">
              </div>
              <div class="col s6">
                <p>Name: <em>{{ house.name }}</em></p>
                <p>Specification: <em>{{ house.spec }}</em></p>
                <p>Published At: <em>{{ house.createdAt }}</em></p>
              </div>
              <div class="col-s12">
                <div :id="'map_'+house._id">

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  </div>

  <!--  Scripts-->
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="js/materialize.js"></script>
  <script src="js/init.js"></script>
  <script src="http://maps.google.com/maps/api/js"></script>
  <script src="js/gmaps.js"></script>
  <script src="https://unpkg.com/vue/dist/vue.js"></script>

  <script>
  let lat = 0; lng = 0;

  var app = new Vue({
    el: '#app',
    data: {
      houses: [],
    },
    methods: {
      getHouses: function() {
        $.ajax({
          type: 'GET',
          url: 'http://localhost:3000/api/houses',
          dataType: 'json',
          success: function(res) {
            app.houses = res
          }
        })
      },
      addHouse: function() {
        $.ajax({
          type: 'POST',
          url: 'http://localhost:3000/api/houses',
          dataType: 'json',
          data: {
            name: $('#name').val(),
            price: $('#price').val(),
            spec: $('#spec').val(),
            image: $('#image').val(),
            lat: lat,
            lng: lng
          },
          success: function(res) {
            console.log(res, lat, lng);
            app.houses.push(res)
          }
        })
      },
      deleteHouse: function() {
        $.ajax({
          type: 'DELETE'
        })
      }
    }
  })
  app.getHouses()

  $('#open_form').click(function(){
    setTimeout(function(){
      var map = new GMaps({
        el: '#map',
        lat: -6.252847984958682,
        lng: 106.81172668933868
      });

      GMaps.on('click', map.map, function(event) {
         var index = map.markers.length;
         lat = event.latLng.lat();
         lng = event.latLng.lng();
         console.log(lat);
         console.log(lng);
         map.removeMarkers()
         map.addMarker({
           lat: lat,
           lng: lng,
           infoWindow: {
             content: '<p>HTML Content</p>'
           }
         });
       })
    }, 1000)
  })


  </script>
  </body>
</html>
